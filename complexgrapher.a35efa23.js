function e(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},r=t.parcelRequire94c2;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){o[e]=t},t.parcelRequire94c2=r),r.register("hAv0Z",(function(t,n){var o,r;e(t.exports,"register",(function(){return o}),(function(e){return o=e})),e(t.exports,"resolve",(function(){return r}),(function(e){return r=e}));var i={};o=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)i[t[n]]=e[t[n]]},r=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),r("hAv0Z").register(JSON.parse('{"fujT7":"complexgrapher.a35efa23.js","dq1cl":"webkitTest.5c78f70c.js","egthy":"main.3287f773.js","1GZwD":"main.66bf90c5.js","ainsM":"chunkloader.97209084.js","bumwR":"chunkloader.82f01b80.js","2KAe5":"complexgrapher.7ef47e06.js"}'));var i=r("jPsve"),a=r("hC7R7");r("hC7R7"),i=r("jPsve"),a=r("hC7R7");const c=(0,i.create)(i.all),s={pi:a.Complex.PI,e:a.Complex.E,i:a.Complex.I,inf:a.Complex.INFINITY,infinity:a.Complex.INFINITY,epsilon:a.Complex.EPSILON,nan:a.Complex.NAN},l={gamma(){return c.gamma(this)},ln:a.Complex.prototype.log},u={add:a.Complex.prototype.add,unaryPlus(){return this},subtract:a.Complex.prototype.sub,unaryMinus:a.Complex.prototype.neg,multiply:a.Complex.prototype.mul,divide:a.Complex.prototype.div,pow:a.Complex.prototype.pow,factorial(){return c.gamma(this.add(1))}};let d;var p;function f(e){let{name:t}=e;if(t=t.toLowerCase(),"z"===t)return{type:"z"};if(d.isMethod(t))return{type:"method",f:d.get(t)};if(t in s)return{type:"constant",value:s[t]};if(t in l)return{type:"method",f:l[t]};throw new Error(`Unrecognized symbol [${t}]`)}function m(e,t){if("constant"===e.type)return e.value;if("function"===e.type)return e.f(t);if("z"===e.type)return t;throw new Error(`Unrecognized fold result ${e.type}`)}function h(e,t){let n=t.map((e=>g(e)));if(n.every((e=>"constant"===e.type))){const[t,...o]=n.map((e=>e.value)),r=(0,a.Complex)(t);return{type:"constant",value:e.apply(r,o)}}const[o,...r]=n;return{type:"function",f:t=>{let n=(0,a.Complex)(m(o,t)),i=r.map((e=>m(e,t)));return e.apply(n,i)}}}function g(e){switch(e.type){case"ConstantNode":return{type:"constant",value:e.value};case"FunctionNode":{const t=f(e.fn);if("method"===t.type)return h(t.f,e.args);if("constant"===t.type)throw new Error(`Expected function, got constant [${e.fn.name} = ${t.value}]`);if("z"===t.type)throw new Error("Expected function, got [z]");throw new Error(`Expected function, got [${t.type}]`)}case"OperatorNode":{const t=function(e,t){if(t in e)return e[t]}(u,e.fn),n=t?h(t,e.args):void 0;if(void 0===n)throw new Error(`Unexpected operator [${e.op}]`);return n}case"ParenthesisNode":return g(e.content);case"SymbolNode":{const t=f(e);if("method"===t.type)throw new Error(`Unexpected function [${e.name}]`);return t}default:throw new Error(`Cannot parse [${e.type}] into complex function`)}}(p=d||(d={})).isMethod=function(e){return e in a.Complex.prototype},p.get=function(e){const t=a.Complex.prototype[e];return t instanceof Function?t:function(){return this[e]}},p.wrap=function(e){return function(){return e(this)}};const y=(0,i.create)(i.all),v=document.querySelector("div#wrapper"),w=document.querySelector("div#controls"),x=document.querySelector("input#func-input"),b=document.querySelector("#graph-button"),C=document.querySelector("div#graph-status"),E=document.querySelectorAll("div#z-wrapper code"),S=document.querySelectorAll("button.zoom"),L=document.querySelector("input#zoom-input"),A=document.querySelectorAll("input.center-input"),q=document.querySelector("button#recenter-button"),R=document.querySelector("button#home-button"),$=document.querySelectorAll(".domain"),I=document.createElement("canvas"),N=I.getContext("2d",{alpha:!1});async function M(){await se();const{width:e,height:t}=I.getBoundingClientRect();de(I,"width",Math.trunc(e)),de(I,"height",Math.trunc(t)),N.globalCompositeOperation="copy",F()}v.appendChild(I),M();const Y=document.createElement("canvas"),k=Y.getContext("2d",{alpha:!1});let z;!function(e){const t={refs:0,mat:y.identity(3)};function n(){t.refs||(Y.width=I.width,Y.height=I.height,k.globalCompositeOperation="copy",k.imageSmoothingEnabled=!1,k.drawImage(I,0,0),t.mat=y.identity(3)),t.refs++}function o(){t.refs=Math.max(t.refs-1,0)}function r(){if(t.refs){const{mat:e}=t;T++,T|=0,N.setTransform(e.get([0,0]),e.get([1,0]),e.get([0,1]),e.get([1,1]),e.get([0,2]),e.get([1,2])),N.drawImage(Y,0,0),N.resetTransform()}}e.prepare=n,e.release=o,e.borrow=function(e,i=!0){const a=0===t.refs;n(),e(a),i&&a&&r(),o()},e.draw=r,e.translate=function(e,n){t.mat=y.multiply(y.matrix([[1,0,e],[0,1,n],[0,0,1]]),t.mat)},e.scaleAround=function(e,n){const[o,r]=n??[(I.width-1)/2,(I.height-1)/2];t.mat=y.chain(y.matrix([[1,0,o],[0,1,r],[0,0,1]])).multiply(y.matrix([[1/e,0,0],[0,1/e,0],[0,0,1]])).multiply(y.matrix([[1,0,-o],[0,1,-r],[0,0,1]])).multiply(t.mat).done()}}(z||(z={}));let O=a.Complex.ZERO;function D(e,t){(t?.updateBuffer??1)&&z.borrow((()=>{const t=O.sub(e),n=ne.toCanvasDisplace(t);z.translate(...n)})),O=e,A[0].value=`${e.re}`,A[1].value=`${e.im}`,pe(q,e.equals(0,0)),pe(R,e.equals(0,0)&&2===X),F()}document.querySelectorAll("#center-controls form").forEach((e=>{e.addEventListener("submit",(e=>{const t=+A[0].value,n=+A[1].value;D((0,a.Complex)(t,n))}))})),q.addEventListener("click",(e=>{D(a.Complex.ZERO)}));let T=0,X=2;function _(e,t){e=Math.max(e,Number.EPSILON),(t?.updateBuffer??1)&&z.borrow((()=>{const t=e/X;z.scaleAround(t)})),X=e,L.value=""+2/X,L.style.width=`${L.value.length}ch`,S[1].disabled=2===X,pe(R,O.equals(0,0)&&2===X),F()}function H(e,t,n){const o=2**(.005*n),r=ne.toComplex(e,t),i=r.sub(O);z.borrow((()=>{D(r.sub(i.mul(o))),_(X*o)}))}{const[fe,me,he]=S;fe.addEventListener("click",(()=>_(X/2))),me.addEventListener("click",(()=>_(2))),he.addEventListener("click",(()=>_(2*X)))}function j(){return[X*I.width/I.height,X]}function F(){const e=!!+getComputedStyle(document.documentElement).getPropertyValue("--limit-domain"),[t,n]=j(),o=(0,a.Complex)(t,n),r=O.sub(o),i=O.add(o);if(e){let{re:e,im:t}=r,{re:n,im:o}=i;const a=-1===Math.sign(t)?"-":"+",c=-1===Math.sign(t)?"-":"+",s=P(e),l=P(n),u=P(Math.abs(t)),d=P(Math.abs(o));$[0].textContent=`${s} ${a} ${u}i`,$[1].textContent=`${l} ${c} ${d}i`}else $[0].textContent=`${r}`,$[1].textContent=`${i}`}function P(e){const t=e.toPrecision(),n=e.toPrecision(5);return t.length<=n.length?t:n}R.addEventListener("click",(()=>{z.borrow((()=>{D(a.Complex.ZERO),_(2)}))}));let U,Z,B=e=>e;var J,W;W=function(e,t,n){if(t===self.location.origin)return e;var o=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let G=new URL(r("hAv0Z").resolve("dq1cl"),import.meta.url);J=W(G.toString(),G.origin,!0);let K=new Worker(J);K.postMessage(void 0);var V;let Q=new URL(r("hAv0Z").resolve("egthy"),import.meta.url);V=W(Q.toString(),Q.origin,!0);var ee;let te,ne,oe=new URL(r("hAv0Z").resolve("ainsM"),import.meta.url);ee=W(oe.toString(),oe.origin,!0),K.onmessage=async function(e){C.textContent="Initializing workers...",await se(),Z=e.data,U=Z?new Worker(V):new Worker(ee),await async function(e){let t={action:"init"};return e.postMessage(t),new Promise((t=>{e.onmessage=function(e){t()}}))}(U),U.onmessage=function(e){let t=e.data;if(t.graphID===T)if("chunkDone"===t.action)!function(e){let{chunk:t,buf:n}=e,o=new ImageData(new Uint8ClampedArray(n),t.width,t.height);N.putImageData(o,t.offx,t.offy)}(t);else if("done"===t.action)!async function(e){C.textContent=`Done in ${e}ms.`,C.classList.add("done"),await se(),function(e=1e3){setTimeout((()=>{C.classList.contains("done")&&(C.classList.remove("done"),C.classList.add("hidden"))}),e)}()}(t.time);else{}},U.onerror=ue,b.disabled=!1,K.terminate(),document.querySelectorAll(".initializing").forEach((e=>e.classList.remove("initializing"))),ce()};{let ge=new Map;function re(e){const t=ge.get(e.pointerId);if(ge.delete(e.pointerId)&&z.release(),0===ge.size&&t){const[n,o]=[e.clientX-t.initX,e.clientY-t.initY];0===n&&0===o||ce()}}function ie(e){const t=e.length,[n,o]=e.reduce((([e,t],[n,o])=>[e+n,t+o])),r=[n/t,o/t],[i,a]=r;return[r,e.map((([e,t])=>Math.hypot(e-i,t-a))).reduce(((e,t)=>e+t))]}I.addEventListener("pointerdown",(e=>{let t,n,o,r;o=t=e.clientX,r=n=e.clientY,ge.set(e.pointerId,{initX:t,initY:n,lastX:o,lastY:r}),z.prepare()})),document.addEventListener("pointerup",re),document.addEventListener("pointercancel",re),document.addEventListener("pointermove",(e=>{const t=ge.get(e.pointerId);if(t)if(1===ge.size){const[n,o]=[e.clientX-t.lastX,e.clientY-t.lastY],r=ne.toComplexDisplace(n,o);D(O.sub(r)),z.draw(),t.lastX=e.clientX,t.lastY=e.clientY}else{let n=Array.from(ge.values(),(({lastX:e,lastY:t})=>[e,t]));const[o,r]=ie(n);t.lastX=e.clientX,t.lastY=e.clientY,n=Array.from(ge.values(),(({lastX:e,lastY:t})=>[e,t]));const[i,a]=ie(n);H(...i,r-a),z.draw()}}))}{let ye,ve=!1;I.addEventListener("wheel",(e=>{if(e.preventDefault(),clearTimeout(ye),ve||(ve=!0,z.prepare()),e.ctrlKey)H(e.clientX,e.clientY,e.deltaY),z.draw();else{const t=.5*e.deltaX,n=.5*e.deltaY,o=ne.toComplexDisplace(t,n);D(O.sub(o)),z.draw()}ae(e),ye=setTimeout((()=>{ce(),z.release(),ve=!1}),500)}),!1)}async function ae(...e){const t=function({pageX:e,pageY:t}){const n=e-I.offsetLeft,o=t-I.offsetTop,{width:r,height:i}=I.getBoundingClientRect();if(!(n<0||n>=r||o<0||o>=i))return ne.toComplex(n,o)}(...e);if(void 0!==t){const[e,n]=E;e.textContent=`${t}`,n.textContent=`${B?.(t)??"?"}`}}async function ce(){if(b.disabled)return;C.classList.remove("hidden","error","done"),C.textContent="Graphing...",await M(),await se();let e=x.value;try{const t=function(e){const t=g(c.parse(e));switch(t.type){case"constant":return{type:"constant",f:t.value};case"function":return t;case"z":return{type:"function",f:e=>e};default:throw new Error(`Invalid fold result type ${t.type}`)}}(e);B="function"===t.type?t.f:()=>t.f,function(e,t){T++,T|=0;let n={action:"mainRequest",pev:le(t),cd:{width:I.width,height:I.height,center:[O.re,O.im],scale:X},graphID:T};e.postMessage(n)}(U,e)}catch(e){throw ue(e),e}}async function se(){return new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>e()))}))}))}function le(e){let t=y.simplify(e),n=!1;return"OperatorNode"!=t.type||"divide"!=t.fn||isNaN(+t.args[0])||(t.args.reverse(),t=y.simplify(t),n=!0),{fstr:t.toString(),inverse:n}}function ue(e){let t=e instanceof ErrorEvent?e.message:e;C.classList.add("error"),C.textContent=String(t)}function de(e,t,n){e[t]!==n&&(e[t]=n)}function pe(e,t){e.classList.toggle("hidden",t),e instanceof HTMLButtonElement&&(e.disabled=t)}I.addEventListener("mousemove",ae),w.addEventListener("mousemove",ae),document.addEventListener("click",ae),window.addEventListener("resize",(e=>{void 0!==te&&clearTimeout(te),te=setTimeout((async()=>await ce()),200)})),document.querySelector("form#zoom-form").addEventListener("submit",(()=>{L.checkValidity()&&_(2/+L.value)})),document.querySelectorAll("form.graph-submit").forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault(),ce()}))})),document.querySelectorAll("button.graph-submit").forEach((e=>{e.addEventListener("click",(()=>{ce()}))})),function(e){function t(e,t){const{width:n,height:o}=I,[r,i]=j(),[c,s]=[(n-1)/2,-(o-1)/2];return(0,a.Complex)(e*r/c,t*i/s)}function n(e){const{width:t,height:n}=I,[o,r]=j(),[i,a]=[(t-1)/2,-(n-1)/2];return[e.re*i/o,e.im*a/r]}e.toComplex=function(e,n){const[o,r]=[(I.width-1)/2,(I.height-1)/2],i=t(e-o,n-r);return O.add(i)},e.toComplexDisplace=t,e.toCanvas=function(e){const[t,o]=[(I.width-1)/2,(I.height-1)/2],r=e.sub(O),[i,a]=n(r);return[t+i,o+a]},e.toCanvasDisplace=n}(ne||(ne={}));
//# sourceMappingURL=complexgrapher.a35efa23.js.map
