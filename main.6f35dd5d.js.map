{"mappings":"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","sources":["node_modules/.pnpm/@swc+helpers@0.4.2/node_modules/@swc/helpers/src/_async_to_generator.mjs","node_modules/.pnpm/@parcel+runtime-js@2.6.2_@parcel+core@2.6.2/node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/.pnpm/@parcel+runtime-js@2.6.2_@parcel+core@2.6.2/node_modules/@parcel/runtime-js/lib/runtime-640374faf90b6590.js","src/complexgrapher/worker/main.ts","node_modules/.pnpm/@parcel+runtime-js@2.6.2_@parcel+core@2.6.2/node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","node_modules/.pnpm/@parcel+runtime-js@2.6.2_@parcel+core@2.6.2/node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/.pnpm/@parcel+runtime-js@2.6.2_@parcel+core@2.6.2/node_modules/@parcel/runtime-js/lib/runtime-e353846d0a4aedce.js"],"sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n      args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"egthy\\\":\\\"main.6f35dd5d.js\\\",\\\"ainsM\\\":\\\"chunkloader.1feee9f4.js\\\",\\\"1GZwD\\\":\\\"main.8f636bc4.js\\\",\\\"bumwR\\\":\\\"chunkloader.afb6063f.js\\\"}\"));","import { MainIn, MainOut, LoaderIn, LoaderOut, CanvasData, PartialEvaluator, InitIn, InitOut } from \"../types\";\n\nconst CHUNK_SIZE = 50;\nconst N_WORKERS = 4;\n\nlet free: Worker[] = [];\n\ntype Ticket = [LoaderIn, Symbol, number];\n\n/**\n * Map that links a worker to the task they've been assigned\n */\nlet labor: Map<Worker, [Symbol, number]> = new Map();\n\n/**\n * The queue to pull work from\n */\nlet workQueue: Generator<Ticket>;\n\n/**\n * The current task to be working on\n */\nlet currentTask: Symbol;\n\nonmessage = async function (e: MessageEvent<InitIn | MainIn>) {\n    let data = e.data;\n\n    if (data.action === \"init\") {\n        await initLoaders();\n        self.postMessage({action: \"ready\"});\n    } else if (data.action === \"mainRequest\") {\n        let start = this.performance.now();\n        let {pev, cd} = data;\n\n        // on a request, start up the queue and assign work to all currently free workers\n        workQueue = queue(start, pev, cd);\n    \n        let fit = free[Symbol.iterator]();\n        for (let w of fit) {\n            let t = workQueue.next();\n    \n            if (!t.done) {\n                assignWorkToWorker(w, t.value);\n            } else {\n                break;\n            }\n        }\n        free = [...fit];\n    } else {\n        let _: never = data;\n        throw new Error(\"Unexpected request into main worker\");\n    }\n}\n\n/**\n * @returns a promise which resolves once all the chunkLoaders have been created and initialized\n */\nasync function initLoaders() {\n    if (free.length > 0) return;\n    \n    free = Array.from({length: N_WORKERS}, () => \n        new Worker(new URL(\"./chunkLoader\", import.meta.url), {type: \"module\"})\n    );\n\n    let promises = Array.from(free, w => \n        new Promise<Worker>(resolve => {\n            w.onmessage = function (e: MessageEvent<InitOut>) {\n                resolve(w);\n            }\n            w.postMessage({action: \"init\"});\n        })\n        .then(w => {\n            w.onmessage = function (e: MessageEvent<LoaderOut>) {\n                let out = e.data;\n        \n                let ticket = labor.get(w);\n                if (typeof ticket === \"undefined\") return; // worker wasn't working on a ticket\n\n                // If the current task is the currentTask, post up \"loadChunk\"\n                let [sym, start] = ticket;\n                if (currentTask == sym) {\n                    self.postMessage(out, [out.buf] as any);\n                }\n        \n                // If there's any more work left to do, take it.\n                // Otherwise, free the worker and post up \"done\"\n                let t = workQueue.next();\n                if (!t.done) {\n                    // reassign\n                    assignWorkToWorker(w, t.value);\n                } else {\n                    // no more work to do, free the worker\n                    freeWorker(w);\n        \n                    // if all chunks finished, send done\n                    if (typeof start !== \"undefined\" && labor.size == 0) {\n                        let done: MainOut = { action: \"done\", time: Math.trunc(performance.now() - start) };\n                        self.postMessage(done);\n                    }\n                }\n            }\n        \n            w.onerror = function (e) {\n                freeWorker(w);\n            }\n        })\n    );\n    \n    return await Promise.all(promises);\n}\n\n/**\n * Generator that breaks up the canvas into computable chunks, which can be sent to chunkLoaders to compute them\n * @param start Time queue started\n * @param pev Partial evaluator that needs to be evaluated\n * @param cd The dimension data of the canvas to chunk\n */\nfunction* queue(start: number, pev: PartialEvaluator, cd: CanvasData): Generator<Ticket> {\n    let {width, height} = cd;\n    currentTask = Symbol(\"task\");\n\n    for (let i = 0; i < width; i += CHUNK_SIZE) {\n        for (let j = 0; j < height; j += CHUNK_SIZE) {\n            let cw = clamp(0, CHUNK_SIZE, width - i);\n            let ch = clamp(0, CHUNK_SIZE, height - j);\n\n            yield [{\n                action: \"chunkRequest\",\n                pev, cd,\n                chunk: {\n                    width: cw, height: ch, offx: i, offy: j\n                }\n            }, currentTask, start];\n        }\n    }\n}\n\n/**\n * Designate a worker as free to work.\n * @param w Worker to mark as free.\n */\nfunction freeWorker(w: Worker) {\n    labor.delete(w);\n    free.push(w);\n}\n\n/**\n * Assign a worker a chunk to compute.\n * @param w Worker to designate.\n * @param param1 Ticket to work on.\n */\nfunction assignWorkToWorker(w: Worker, [job, sym, start]: Ticket) {\n    w.postMessage(job);\n    labor.set(w, [sym, start]);\n}\n\nfunction clamp(v: number, min: number, max: number) {\n    return Math.max(min, Math.min(v, max));\n}","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","let workerURL = require('./helpers/get-worker-url');\nlet bundleURL = require('./helpers/bundle-url');\nlet url = bundleURL.getBundleURL('egthy') + require('./helpers/bundle-manifest').resolve(\"ainsM\");module.exports = workerURL(url, bundleURL.getOrigin(url), false);"],"names":["$2f0e95f5075ca271$var$asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","$2f0e95f5075ca271$export$2e2bcd8739ae039","fn","self","this","args","arguments","apply","err","undefined","$80e15077136f1bb4$export$6503ec6e8aabbaf","$80e15077136f1bb4$export$f7ad0328861e2f03","$80e15077136f1bb4$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$eaa7eee168885edc$var$workQueue","$eaa7eee168885edc$var$currentTask","$eaa7eee168885edc$var$queue","$eaa7eee168885edc$var$free","$eaa7eee168885edc$var$labor","Map","$eaa7eee168885edc$var$initLoaders","$eaa7eee168885edc$var$_initLoaders","onmessage","$parcel$interopDefault","$7RWEw","mark","_callee","e","data","start","pev","cd","fit","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","w","t","action","postMessage","performance","now","Symbol","iterator","next","$eaa7eee168885edc$var$assignWorkToWorker","_ctx","t0","return","$3YVW8","default","$8f9f997e5849ab77$export$bdfd709ae4826697","$8f9f997e5849ab77$export$5a759dc7a1cfb72a","$4692b60c6c40fc29$exports","workerUrl","origin","isESM","location","source","stringify","URL","createObjectURL","Blob","type","$8f9f997e5849ab77$var$bundleURL","$8f9f997e5849ab77$var$getBaseURL","url","replace","matches","stack","match","$8f9f997e5849ab77$var$getBundleURL","$1e1a9b7a02f12fc7$var$url","promises","Array","from","Worker","$1e1a9b7a02f12fc7$exports","w1","out","ticket","get","_ticket","$jKWlR","sym","buf","$eaa7eee168885edc$var$freeWorker","size","time","Math","trunc","onerror","all","width","height","j","cw","ch","$eaa7eee168885edc$var$clamp","chunk","offx","offy","delete","push","param","_param","job","set","v","min","max"],"version":3,"file":"main.6f35dd5d.js.map"}