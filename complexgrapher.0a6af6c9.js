function e(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},r=t.parcelRequire94c2;null==r&&((r=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){o[e]=t},t.parcelRequire94c2=r),r.register("hAv0Z",(function(t,n){var o,r;e(t.exports,"register",(function(){return o}),(function(e){return o=e})),e(t.exports,"resolve",(function(){return r}),(function(e){return r=e}));var i={};o=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)i[t[n]]=e[t[n]]},r=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),r("hAv0Z").register(JSON.parse('{"fujT7":"complexgrapher.0a6af6c9.js","dq1cl":"webkitTest.5c78f70c.js","egthy":"main.512522d2.js","1GZwD":"main.66bf90c5.js","ainsM":"chunkloader.bc8a9feb.js","bumwR":"chunkloader.c3aaeffc.js","2KAe5":"complexgrapher.27645573.js"}'));var i=r("jPsve"),a=r("hC7R7");r("hC7R7"),i=r("jPsve"),a=r("hC7R7");const c=(0,i.create)(i.all),s={pi:a.Complex.PI,e:a.Complex.E,i:a.Complex.I,inf:a.Complex.INFINITY,infinity:a.Complex.INFINITY,epsilon:a.Complex.EPSILON,nan:a.Complex.NAN};function u(e){let{name:t}=e;if(t=t.toLowerCase(),"z"===t)return{type:"z"};if(function(e){return e in a.Complex.I}(t))return{type:"method",name:t};if(t in s)return{type:"constant",value:s[t]};throw new Error(`Unrecognized symbol [${t}]`)}const l={add:e=>e.add.bind(e),unaryPlus:e=>()=>e,subtract:e=>e.sub.bind(e),unaryMinus:e=>e.neg.bind(e),multiply:e=>e.mul.bind(e),divide:e=>e.div.bind(e),pow:e=>e.pow.bind(e),factorial:e=>()=>c.gamma(e.add(1))};function d(e,t){if("constant"===e.type)return e.value;if("function"===e.type)return e.f(t);if("z"===e.type)return t;throw new Error(`Unrecognized fold result ${e.type}`)}function f(e,t,n){let o=t.map((e=>m(e)));if(o.every((e=>"constant"===e.type))){const[t,...n]=o.map((e=>e.value)),r=(0,a.Complex)(t),i=e(r);return"number"==typeof i?{type:"constant",value:i}:{type:"constant",value:i.bind(r)(...n)}}const[r,...i]=o;if(n)return{type:"function",f:t=>{let n=(0,a.Complex)(d(r,t)),o=i.map((e=>d(e,t)));const c=e(n);return"number"==typeof c?c:c.bind(n)(...o)}}}function m(e,t=!0){switch(e.type){case"ConstantNode":return{type:"constant",value:e.value};case"FunctionNode":{const n=u(e.fn);if("method"===n.type){const o=f((e=>e[n.name]),e.args,t);if(void 0===o)throw new Error(`Unexpected function [${n.name}]`);return o}if("constant"===n.type)throw new Error(`Expected function, got constant [${e.fn.name} = ${n.value}]`);if("z"===n.type)throw new Error("Expected function, got [z]");throw new Error(`Expected function, got [${n.type}]`)}case"OperatorNode":{const n=function(e,t){if(t in e)return e[t]}(l,e.fn),o=n?f(n,e.args,t):void 0;if(void 0===o)throw new Error(`Unexpected operator [${e.op}]`);return o}case"ParenthesisNode":return m(e.content);case"SymbolNode":{const t=u(e);if("method"===t.type)throw new Error(`Unexpected function [${e.name}]`);return t}default:throw new Error(`Cannot parse [${e.type}] into complex function`)}}const p=(0,i.create)(i.all),h=document.querySelector("div#wrapper"),g=document.querySelector("div#controls"),v=document.querySelector("input#func-input"),y=document.querySelector("#graph-button"),w=document.querySelector("div#graph-status"),b=document.querySelectorAll("div#z-wrapper code"),E=document.querySelectorAll("button.zoom"),x=document.querySelector("input#zoom-input"),C=document.querySelectorAll("input.center-input"),L=document.querySelector("button#recenter-button"),S=document.querySelector("button#home-button"),q=document.querySelectorAll(".domain"),A=document.createElement("canvas"),R=A.getContext("2d",{alpha:!1});async function N(){await ie();const{width:e,height:t}=A.getBoundingClientRect();de(A,"width",Math.trunc(e)),de(A,"height",Math.trunc(t)),R.globalCompositeOperation="copy",P()}h.appendChild(A),N();const k=document.createElement("canvas"),I=k.getContext("2d",{alpha:!1}),$={refs:0,mat:p.identity(3)};function O(){$.refs||(k.width=A.width,k.height=A.height,I.globalCompositeOperation="copy",I.imageSmoothingEnabled=!1,I.drawImage(A,0,0),$.refs++,$.mat=p.identity(3))}function z(){if($.refs){const{mat:e}=$;R.setTransform(e.get([0,0]),e.get([1,0]),e.get([0,1]),e.get([1,1]),e.get([0,2]),e.get([1,2])),R.drawImage(k,0,0),R.resetTransform()}}function _(e,t){$.mat=p.multiply(p.matrix([[1,0,e],[0,1,t],[0,0,1]]),$.mat)}function T(e,t){const[n,o]=t??[(A.width-1)/2,(A.height-1)/2];$.mat=p.chain(p.matrix([[1,0,n],[0,1,o],[0,0,1]])).multiply(p.matrix([[1/e,0,0],[0,1/e,0],[0,0,1]])).multiply(p.matrix([[1,0,-n],[0,1,-o],[0,0,1]])).multiply($.mat).done()}function j(){$.refs=Math.max($.refs-1,0)}let H=a.Complex.ZERO;function F(e){H=e,C[0].value=`${e.re}`,C[1].value=`${e.im}`,L.classList.toggle("hidden",e.equals(0,0)),S.classList.toggle("hidden",e.equals(0,0)&&2===D),P()}document.querySelectorAll("#center-controls form").forEach((e=>{e.addEventListener("submit",(e=>{const t=+C[0].value,n=+C[1].value;F((0,a.Complex)(t,n))}))})),L.addEventListener("click",(e=>{F(a.Complex.ZERO)}));let U=0,D=2;function M(e,t=!0){se();const n=(e=Math.max(e,0))/D;D=e,t&&(O(),T(n),z(),j()),x.value=""+2/D,x.style.width=`${x.value.length}ch`,E[1].disabled=2===D,S.classList.toggle("hidden",H.equals(0,0)&&2===D),P()}{const[e,t,n]=E;e.addEventListener("click",(()=>M(D/2))),t.addEventListener("click",(()=>M(2))),n.addEventListener("click",(()=>M(2*D)))}function Y(){return[D*A.width/A.height,D]}function P(){const[e,t]=Y(),n=(0,a.Complex)(e,t),o=H.sub(n),r=H.add(n);q[0].textContent=`${o}`,q[1].textContent=`${r}`}S.addEventListener("click",(()=>{const{width:e,height:t}=A,[n,o]=Y(),[r,i]=[(e-1)/2,-(t-1)/2],[c,s]=[H.re*r/n,H.im*i/o];O(),_(c,s),z(),j(),F(a.Complex.ZERO),M(2)}));let Z,X,B=e=>e;var J,W;W=function(e,t,n){if(t===self.location.origin)return e;var o=n?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let G=new URL(r("hAv0Z").resolve("dq1cl"),import.meta.url);J=W(G.toString(),G.origin,!0);let K=new Worker(J);K.postMessage(void 0);var V;let Q=new URL(r("hAv0Z").resolve("egthy"),import.meta.url);V=W(Q.toString(),Q.origin,!0);var ee;let te,ne=new URL(r("hAv0Z").resolve("ainsM"),import.meta.url);ee=W(ne.toString(),ne.origin,!0),K.onmessage=async function(e){w.textContent="Initializing workers...",await ie(),X=e.data,Z=X?new Worker(V):new Worker(ee),await async function(e){let t={action:"init"};return e.postMessage(t),new Promise((t=>{e.onmessage=function(e){t()}}))}(Z),Z.onmessage=function(e){let t=e.data;if(t.graphID===U)if("chunkDone"===t.action)!function(e){let{chunk:t,buf:n}=e,o=new ImageData(new Uint8ClampedArray(n),t.width,t.height);R.putImageData(o,t.offx,t.offy)}(t);else if("done"===t.action)!async function(e){w.textContent=`Done in ${e}ms.`,w.classList.add("done"),await ie(),function(e=1e3){setTimeout((()=>{w.classList.contains("done")&&(w.classList.remove("done"),w.classList.add("hidden"))}),e)}()}(t.time);else{}},Z.onerror=le,y.disabled=!1,K.terminate(),document.querySelectorAll(".initializing").forEach((e=>e.classList.remove("initializing"))),re()};{let e=!1,t=0,n=0,o=0,r=0;A.addEventListener("mousedown",(i=>{e=!0,o=t=i.clientX,r=n=i.clientY,O()})),document.addEventListener("mouseup",(o=>{if(e){e=!1;const[r,i]=[o.clientX-t,o.clientY-n];0===r&&0===i||re()}})),document.addEventListener("mousemove",(t=>{if(e){se();const[e,n]=[t.clientX-o,t.clientY-r];_(e,n),z(),F(H.sub(ce(e,n))),o=t.clientX,r=t.clientY}}))}{let e,t=!1;A.addEventListener("wheel",(n=>{if(n.preventDefault(),se(),clearTimeout(e),t||(t=!0,O()),n.ctrlKey)!function(e,t,n){const o=2**(.005*n),r=ae(e,t),i=r.sub(H);F(r.sub(i.mul(o))),M(D*o,!1),T(o,[e,t]),z()}(n.clientX,n.clientY,n.deltaY);else{const e=.5*n.deltaX,t=.5*n.deltaY;_(e,t),z(),F(H.sub(ce(e,t)))}oe(n),e=setTimeout((()=>{re(),t=!1}),500)}),!1)}async function oe(...e){const t=function({pageX:e,pageY:t}){const n=e-A.offsetLeft,o=t-A.offsetTop,{width:r,height:i}=A.getBoundingClientRect();if(!(n<0||n>=r||o<0||o>=i))return ae(n,o)}(...e);if(void 0!==t){const[e,n]=b;e.textContent=`${t}`,n.textContent=`${B?.(t)??"?"}`}}async function re(){if(y.disabled)return;w.classList.remove("hidden","error","done"),w.textContent="Graphing...",await N(),await ie(),$.refs=0,se();let e=v.value;try{const t=function(e){const t=m(c.parse(e));switch(t.type){case"constant":return{type:"constant",f:t.value};case"function":return t;case"z":return{type:"function",f:e=>e};default:throw new Error(`Invalid fold result type ${t.type}`)}}(e);B="function"===t.type?t.f:()=>t.f,function(e,t){U++,U|=0;let n={action:"mainRequest",pev:ue(t),cd:{width:A.width,height:A.height,center:[H.re,H.im],scale:D},graphID:U};e.postMessage(n)}(Z,e)}catch(e){throw le(e),e}}async function ie(){return new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>e()))}))}))}function ae(e,t){const[n,o]=[(A.width-1)/2,(A.height-1)/2];return H.add(ce(e-n,t-o))}function ce(e,t){const{width:n,height:o}=A,[r,i]=Y(),[c,s]=[(n-1)/2,-(o-1)/2];return(0,a.Complex)(e*r/c,t*i/s)}function se(){U++,U|=0}function ue(e){let t=p.simplify(e),n=!1;return"OperatorNode"!=t.type||"divide"!=t.fn||isNaN(+t.args[0])||(t.args.reverse(),t=p.simplify(t),n=!0),{fstr:t.toString(),inverse:n}}function le(e){let t=e instanceof ErrorEvent?e.message:e;w.classList.add("error"),w.textContent=String(t)}function de(e,t,n){e[t]!==n&&(e[t]=n)}A.addEventListener("mousemove",oe),g.addEventListener("mousemove",oe),document.addEventListener("click",oe),window.addEventListener("resize",(e=>{void 0!==te&&clearTimeout(te),te=setTimeout((async()=>await re()),200)})),document.querySelector("form#zoom-form").addEventListener("submit",(()=>{x.checkValidity()&&M(2/+x.value)})),document.querySelectorAll("form.graph-submit").forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault(),re()}))})),document.querySelectorAll("button.graph-submit").forEach((e=>{e.addEventListener("click",(()=>{re()}))}));
//# sourceMappingURL=complexgrapher.0a6af6c9.js.map
