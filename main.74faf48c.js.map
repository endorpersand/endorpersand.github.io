{"mappings":"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","sources":["node_modules/.pnpm/@parcel+runtime-js@2.6.0_@parcel+core@2.6.0/node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/.pnpm/@parcel+runtime-js@2.6.0_@parcel+core@2.6.0/node_modules/@parcel/runtime-js/lib/runtime-6565d5286b27c7ac.js","node_modules/.pnpm/@swc+helpers@0.3.16/node_modules/@swc/helpers/lib/_object_spread.js","node_modules/.pnpm/@parcel+runtime-js@2.6.0_@parcel+core@2.6.0/node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js","src/complexgrapher/worker/main.ts","node_modules/.pnpm/@parcel+runtime-js@2.6.0_@parcel+core@2.6.0/node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/.pnpm/@parcel+runtime-js@2.6.0_@parcel+core@2.6.0/node_modules/@parcel/runtime-js/lib/runtime-e353846d0a4aedce.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"egthy\\\":\\\"main.74faf48c.js\\\",\\\"ainsM\\\":\\\"chunkloader.914ead69.js\\\",\\\"bumwR\\\":\\\"chunkloader.fd61eca3.js\\\",\\\"1GZwD\\\":\\\"main.f471310d.js\\\"}\"));","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = _objectSpread;\nvar _defineProperty = _interopRequireDefault(require(\"./_define_property\"));\nfunction _objectSpread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = arguments[i] != null ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (typeof Object.getOwnPropertySymbols === 'function') {\n            ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n                return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n            }));\n        }\n        ownKeys.forEach(function(key) {\n            (0, _defineProperty).default(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction _interopRequireDefault(obj) {\n    return obj && obj.__esModule ? obj : {\n        default: obj\n    };\n}\n","\"use strict\";\n\nvar bundleURL = {};\n\nfunction getBundleURLCached(id) {\n  var value = bundleURL[id];\n\n  if (!value) {\n    value = getBundleURL();\n    bundleURL[id] = value;\n  }\n\n  return value;\n}\n\nfunction getBundleURL() {\n  try {\n    throw new Error();\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|(chrome|moz)-extension):\\/\\/[^)\\n]+/g);\n\n    if (matches) {\n      // The first two stack frames will be this function and getBundleURLCached.\n      // Use the 3rd one, which will be a runtime in the original bundle.\n      return getBaseURL(matches[2]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|(chrome|moz)-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n} // TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\n\n\nfunction getOrigin(url) {\n  var matches = ('' + url).match(/(https?|file|ftp|(chrome|moz)-extension):\\/\\/[^/]+/);\n\n  if (!matches) {\n    throw new Error('Origin not found');\n  }\n\n  return matches[0];\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\nexports.getOrigin = getOrigin;","import { MainIn, MainOut, LoaderIn, LoaderOut, CanvasData, PartialEvaluator } from \"../types\";\n\nconst CHUNK_SIZE = 50;\nconst N_WORKERS = 4;\n\nlet free = Array.from({length: N_WORKERS}, () => {\n    let w = new Worker(new URL(\"./chunkloader\", import.meta.url), {type: \"module\"});\n\n    w.onmessage = function (e) {\n        let out: LoaderOut = e.data;\n\n        let ticket = labor.get(w);\n        if (typeof ticket === \"undefined\") return;\n        let [sym, start] = ticket;\n        // load chunk\n        if (currentTask == sym) {\n            let msg: MainOut = {action: \"loadChunk\", ...out};\n            self.postMessage(msg, [out.buf] as any);\n        }\n\n        let t = workQueue.next();\n        if (!t.done) {\n            // reassign\n            assignWorkToWorker(w, t.value);\n        } else {\n            // no more work to do, free the worker\n            freeWorker(w);\n\n            // if all chunks finished, send done\n            if (typeof start !== \"undefined\" && labor.size == 0) {\n                let done: MainOut = { action: \"done\", time: Math.trunc(performance.now() - start) };\n                self.postMessage(done);\n            }\n        }\n    }\n\n    w.onerror = function (e) {\n        freeWorker(w);\n    }\n    return w;\n});\n\ntype Ticket = [LoaderIn, Symbol, number];\nlet labor: Map<Worker, [Symbol, number]> = new Map();\nlet workQueue: Generator<Ticket>;\nlet currentTask: Symbol;\n\nonmessage = function (e) {\n    let start = this.performance.now();\n    let {pev, cd}: MainIn = e.data;\n    workQueue = queue(start, pev, cd);\n\n    let fit = free[Symbol.iterator]();\n    for (let w of fit) {\n        let t = workQueue.next();\n\n        if (!t.done) {\n            assignWorkToWorker(w, t.value);\n        } else {\n            break;\n        }\n    }\n    free = [...fit];\n}\n\nfunction* queue(start: number, pev: PartialEvaluator, cd: CanvasData): Generator<Ticket> {\n    let {width, height} = cd;\n    currentTask = Symbol(\"task\");\n\n    for (let i = 0; i < width; i += CHUNK_SIZE) {\n        for (let j = 0; j < height; j += CHUNK_SIZE) {\n            let cw = clamp(0, CHUNK_SIZE, width - i);\n            let ch = clamp(0, CHUNK_SIZE, height - j);\n\n            yield [{\n                pev, cd,\n                chunk: {\n                    width: cw, height: ch, offx: i, offy: j\n                }\n            }, currentTask, start];\n        }\n    }\n}\n\nfunction freeWorker(w: Worker) {\n    labor.delete(w);\n    free.push(w);\n}\n\nfunction assignWorkToWorker(w: Worker, [job, sym, start]: Ticket) {\n    w.postMessage(job);\n    labor.set(w, [sym, start]);\n}\n\nfunction clamp(v: number, min: number, max: number) {\n    return Math.max(min, Math.min(v, max));\n}","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","let workerURL = require('./helpers/get-worker-url');\nlet bundleURL = require('./helpers/bundle-url');\nlet url = bundleURL.getBundleURL('egthy') + require('./helpers/bundle-manifest').resolve(\"ainsM\");module.exports = workerURL(url, bundleURL.getOrigin(url), false);"],"names":["$c025bc6cb3229e80$export$6503ec6e8aabbaf","$c025bc6cb3229e80$export$f7ad0328861e2f03","$c025bc6cb3229e80$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","defineProperty","$ca34147185efd709$exports","value","default","target","arguments","source","ownKeys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","$ca34147185efd709$var$_defineProperty","obj","__esModule","$e1ebe37e841b915d$export$bdfd709ae4826697","$e1ebe37e841b915d$export$5a759dc7a1cfb72a","$eaa7eee168885edc$var$queue","$8e327983ed5f521b$exports","workerUrl","origin","isESM","self","location","stringify","URL","createObjectURL","Blob","type","$e1ebe37e841b915d$var$bundleURL","$e1ebe37e841b915d$var$getBaseURL","url","replace","err","matches","stack","match","$e1ebe37e841b915d$var$getBundleURL","$d2cc2899670e5bb6$var$url","resolve","$d2cc2899670e5bb6$exports","$eaa7eee168885edc$var$workQueue","$eaa7eee168885edc$var$currentTask","$eaa7eee168885edc$var$free","Array","from","w","Worker","onmessage","e","out","data","ticket","$eaa7eee168885edc$var$labor","get","_ticket","$parcel$interopDefault","$027f3","start","msg","action","postMessage","buf","t","next","done","$eaa7eee168885edc$var$freeWorker","size","time","Math","trunc","performance","now","$eaa7eee168885edc$var$assignWorkToWorker","onerror","Map","pev","cd","width","height","j","cw","ch","_ctx","Symbol","$eaa7eee168885edc$var$clamp","chunk","offx","offy","delete","push","param","_param","job","set","v","min","max","this","_data","fit","iterator","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","return","$6McDW"],"version":3,"file":"main.74faf48c.js.map"}